<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <title>کره زمین با ۱۲۰۰ زون UTM</title>
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Vazirmatn", Tahoma, sans-serif;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c2e 0%, #1a1a3e 100%);
            color: #fff;
            overflow: hidden;
        }
        
        #globe-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .header {
            position: absolute;
            top: 20px;
            right: 20px;
            left: 20px;
            text-align: center;
            z-index: 10;
            background: rgba(0, 10, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(64, 156, 255, 0.3);
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 5px;
            margin-bottom: 8px;
            color: #4fc3f7;
        }
        
        .subtitle {
            font-size: 5px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .controls {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 10;
            background: rgba(0, 10, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(64, 156, 255, 0.3);
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-size: 5px;
            color: #bbdefb;
        }
        
        button, select {
            padding: 8px 12px;
            background: rgba(32, 64, 128, 0.7);
            color: white;
            border: 1px solid rgba(64, 156, 255, 0.5);
            border-radius: 5px;
            cursor: pointer;
            font-size:5px;
            transition: all 0.3s ease;
        }
        
        button:hover, select:hover {
            background: rgba(64, 128, 255, 0.7);
        }
        
        .info-panel {
            position: absolute;
            bottom: 30px;
            right: 20px;
            z-index: 10;
            background: rgba(0, 10, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(64, 156, 255, 0.3);
            max-width: 320px;
            font-size: 5px;
            line-height: 1.5;
        }
        
        .info-title {
            color: #4fc3f7;
            margin-bottom: 8px;
            font-size: 5px;
        }
        
        .zone-info {
            color: #bbdefb;
        }
        
        .highlight {
            color: #ffcc80;
            font-weight: bold;
        }
        
        .grid-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .grid-buttons {
            display: flex;
            gap: 5px;
        }
        
        .grid-buttons button {
            flex: 1;
            font-size: 5px;
            padding: 6px 8px;
        }
        
        .grid-status {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        
        .grid-indicator {
            font-size: 5px;
            padding: 3px 8px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .utm-grid { color: #69f0ae; }
        .geo-grid { color: #ff5252; }
        
        .active {
            background: rgba(64, 128, 255, 0.9) !important;
            border-color: #4fc3f7 !important;
        }
        
        @media (max-width: 768px) {
            .controls, .info-panel {
                max-width: 250px;
                font-size: 5px;
            }
            
            .header {
                padding: 10px;
                font-size: 5px;
            }
            
            h1 {
                font-size:5px;
            }
            
            .grid-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="globe-container"></div>
    
    <div class="controls">
        <div class="control-group">
            <label for="rotation-speed">سرعت چرخش:</label>
            <select id="rotation-speed">
                <option value="0">بدون چرخش</option>
                <option value="0.3" selected>کند</option>
                <option value="0.6">متوسط</option>
                <option value="1">سریع</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="label-visibility">نمایش برچسب‌ها:</label>
            <select id="label-visibility">
                <option value="all" selected>Grid Zone Designation</option>
                <option value="zones">Zone Number</option>
                <option value="letters">Zone Letter Only</option>
                <option value="none">None</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>کنترل گرید:</label>
            <div class="grid-controls">
                <div class="grid-buttons">
                    <button id="toggle-utm-grid" class="active">UTM Grid</button>
                    <button id="toggle-geo-grid">Geographic Grid</button>
                </div>
                <div class="grid-buttons">
                    <button id="toggle-both-grids">هر دو گرید</button>
                    <button id="clear-grids">بدون گرید</button>
                </div>
                <div class="grid-status">
                    <span class="grid-indicator utm-grid" id="utm-status">UTM: روشن</span>
                    <span class="grid-indicator geo-grid" id="geo-status">Geo: خاموش</span>
                </div>
            </div>
        </div>
        
        <button id="reset-view">بازنشانی نمای کره</button>
    </div>
    
    <div class="info-panel">
        <div class="info-title">اطلاعات زون UTM</div>
        <div class="zone-info">
            <span id="selected-zone">روی یک زون کلیک کنید</span>
        </div>
    </div>

    <script>
        // تنظیمات اولیه
        const letters = 'CDEFGHJKLMNPQRSTUVWX';  // 20 حرف برای زون‌های عرضی (بدون I و O)
        
        // ایجاد کره زمین
        const globe = Globe()
            .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
            .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
            .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
            .showAtmosphere(true)
            .atmosphereColor('#3a228a')
            .atmosphereAltitude(0.25)
            .labelColor(() => '#ffffff')
            .labelAltitude(0.01)
            .labelResolution(3)
            .labelDotRadius(0)
            .labelSize(1.2)
            (document.getElementById('globe-container'));
        
        // ایجاد ۱۲۰۰ زون (۶۰ طولی × ۲۰ عرضی)
        const labels = [];
        
        for (let zone = 1; zone <= 60; zone++) {
            for (let bandIdx = 0; bandIdx < 20; bandIdx++) {
                const letter = letters[bandIdx];
                
                // محاسبه مرکز هر زون
                const lonCenter = (zone - 30.5) * 6;  // مرکز زون ۱: -177° تا زون ۶۰: +177°
                const latCenter = bandIdx * 8 + 4 - 80;  // از -80° تا +84°
                
                labels.push({
                    id: `${zone}${letter}`,
                    lat: latCenter,
                    lng: lonCenter,
                    text: `${zone}${letter}`,
                    size: 1.2,
                    color: '#ffffff',
                    zone: zone,
                    letter: letter,
                    latCenter: latCenter,
                    lngCenter: lonCenter,
                    latRange: `${latCenter-4}° تا ${latCenter+4}°`,
                    lngRange: `${lonCenter-3}° تا ${lonCenter+3}°`
                });
            }
        }
        
        // افزودن زون‌ها به کره
        globe.labelsData(labels)
            .labelLat(d => d.lat)
            .labelLng(d => d.lng)
            .labelText(d => d.text)
            .labelSize(d => d.size)
            .labelColor(d => d.color)
            .onLabelClick(label => {
                // نمایش اطلاعات زون انتخاب شده
                document.getElementById('selected-zone').innerHTML = 
                    `<span class="highlight">زون ${label.id}</span><br>
                     مختصات مرکز: ${label.lat.toFixed(2)}°N, ${label.lng.toFixed(2)}°E<br>
                     محدوده عرضی: ${label.latRange}<br>
                     محدوده طولی: ${label.lngRange}<br>
                     <span style="color: #69f0ae; font-size: 5px;">سیستم UTM: 6° × 8°</span>`;
            });
        
        // متغیرهای کنترل گرید
        let utmGridEnabled = true;
        let geoGridEnabled = false;
        
        // تابع برای ایجاد گرید UTM (هر 6 درجه طول، هر 8 درجه عرض)
        function createUTMGrid() {
            const utmGridLines = [];
            const utmColor = '#69f0ae'; // سبز روشن
            
            // خطوط طولی UTM (هر 6 درجه) - محدود به 90± درجه
            for (let lon = -180; lon <= 180; lon += 6) {
                const line = [];
                for (let lat = -80; lat <= 84; lat += 2) {
                    // اطمینان از محدوده معتبر
                    if (lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                        line.push([lat, lon]);
                    }
                }
                if (line.length > 0) {
                    utmGridLines.push({
                        coords: line,
                        color: utmColor,
                        type: 'utm_meridian'
                    });
                }
            }
            
            // خطوط عرضی UTM (هر 8 درجه) - محدود به 180± درجه
            for (let lat = -80; lat <= 84; lat += 8) {
                const line = [];
                for (let lon = -180; lon <= 180; lon += 2) {
                    // اطمینان از محدوده معتبر
                    if (lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                        line.push([lat, lon]);
                    }
                }
                if (line.length > 0) {
                    utmGridLines.push({
                        coords: line,
                        color: utmColor,
                        type: 'utm_parallel'
                    });
                }
            }
            
            // مرزهای اصلی UTM (80°S و 84°N)
            const southBoundary = [];
            const northBoundary = [];
            
            for (let lon = -180; lon <= 180; lon += 2) {
                southBoundary.push([-80, lon]);
                northBoundary.push([84, lon]);
            }
            
            utmGridLines.push({
                coords: southBoundary,
                color: '#ffcc80',
                type: 'utm_boundary_south'
            });
            
            utmGridLines.push({
                coords: northBoundary,
                color: '#ffcc80',
                type: 'utm_boundary_north'
            });
            
            return utmGridLines;
        }
        
        // تابع برای ایجاد گرید جغرافیایی سنتی
        function createGeographicGrid() {
            const geoGridLines = [];
            const geoColor = '#ff5252'; // قرمز
            
            // خطوط طول جغرافیایی (هر 15 درجه)
            for (let lon = -180; lon <= 180; lon += 15) {
                const line = [];
                for (let lat = -90; lat <= 90; lat += 2) {
                    // اطمینان از محدوده معتبر
                    if (lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                        line.push([lat, lon]);
                    }
                }
                if (line.length > 0) {
                    geoGridLines.push({
                        coords: line,
                        color: geoColor,
                        type: 'geo_meridian'
                    });
                }
            }
            
            // خطوط عرض جغرافیایی (هر 15 درجه)
            for (let lat = -90; lat <= 90; lat += 15) {
                const line = [];
                for (let lon = -180; lon <= 180; lon += 2) {
                    // اطمینان از محدوده معتبر
                    if (lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                        line.push([lat, lon]);
                    }
                }
                if (line.length > 0) {
                    geoGridLines.push({
                        coords: line,
                        color: geoColor,
                        type: 'geo_parallel'
                    });
                }
            }
            
            // خط استوا با رنگ متفاوت
            const equator = [];
            for (let lon = -180; lon <= 180; lon += 2) {
                equator.push([0, lon]);
            }
            geoGridLines.push({
                coords: equator,
                color: '#ffcc80',
                type: 'equator'
            });
            
            // نصف‌النهار مبدأ با رنگ متفاوت
            const primeMeridian = [];
            for (let lat = -90; lat <= 90; lat += 2) {
                primeMeridian.push([lat, 0]);
            }
            geoGridLines.push({
                coords: primeMeridian,
                color: '#ffcc80',
                type: 'prime_meridian'
            });
            
            return geoGridLines;
        }
        
        // تابع به‌روزرسانی گرید با خطوط ثابت (بدون انیمیشن)
        function updateGrids() {
            let allPaths = [];
            
            if (utmGridEnabled) {
                const utmGrid = createUTMGrid();
                // اطمینان از معتبر بودن تمام نقاط
                const validUTMGrid = utmGrid.filter(path => {
                    return path.coords.every(coord => {
                        const [lat, lon] = coord;
                        return !isNaN(lat) && !isNaN(lon) && 
                               lat >= -90 && lat <= 90 && 
                               lon >= -180 && lon <= 180;
                    });
                });
                allPaths = allPaths.concat(validUTMGrid);
            }
            
            if (geoGridEnabled) {
                const geoGrid = createGeographicGrid();
                // اطمینان از معتبر بودن تمام نقاط
                const validGeoGrid = geoGrid.filter(path => {
                    return path.coords.every(coord => {
                        const [lat, lon] = coord;
                        return !isNaN(lat) && !isNaN(lon) && 
                               lat >= -90 && lat <= 90 && 
                               lon >= -180 && lon <= 180;
                    });
                });
                allPaths = allPaths.concat(validGeoGrid);
            }
            
            // اعمال گرید به کره با خطوط ثابت (بدون dash و انیمیشن)
            globe.pathsData(allPaths)
                .pathPoints(d => d.coords)
                .pathColor(d => d.color)
                .pathStroke(0.7)  // خطوط نازک‌تر برای وضوح بیشتر
                .pathDashLength(0)  // بدون dash (خط پیوسته)
                .pathDashGap(0)     // بدون فاصله
                .pathDashAnimateTime(0);  // بدون انیمیشن
            
            // به‌روزرسانی وضعیت
            document.getElementById('utm-status').textContent = `UTM: ${utmGridEnabled ? 'روشن' : 'خاموش'}`;
            document.getElementById('geo-status').textContent = `Geo: ${geoGridEnabled ? 'روشن' : 'خاموش'}`;
            
            // به‌روزرسانی ظاهر دکمه‌ها
            document.getElementById('toggle-utm-grid').className = utmGridEnabled ? 'active' : '';
            document.getElementById('toggle-geo-grid').className = geoGridEnabled ? 'active' : '';
        }
        
        // کنترل‌های گرید
        document.getElementById('toggle-utm-grid').addEventListener('click', function() {
            utmGridEnabled = !utmGridEnabled;
            updateGrids();
        });
        
        document.getElementById('toggle-geo-grid').addEventListener('click', function() {
            geoGridEnabled = !geoGridEnabled;
            updateGrids();
        });
        
        document.getElementById('toggle-both-grids').addEventListener('click', function() {
            utmGridEnabled = true;
            geoGridEnabled = true;
            updateGrids();
        });
        
        document.getElementById('clear-grids').addEventListener('click', function() {
            utmGridEnabled = false;
            geoGridEnabled = false;
            updateGrids();
        });
        
        // فعال کردن چرخش خودکار
        globe.controls().autoRotate = true;
        globe.controls().autoRotateSpeed = 0.6;
        globe.controls().enableZoom = true;
        
        // کنترل‌های رابط کاربری
        document.getElementById('rotation-speed').addEventListener('change', function(e) {
            const speed = parseFloat(e.target.value);
            globe.controls().autoRotate = speed > 0;
            globe.controls().autoRotateSpeed = speed;
        });
        
        document.getElementById('label-visibility').addEventListener('change', function(e) {
            const visibility = e.target.value;
            
            const updatedLabels = labels.map(label => {
                const newLabel = {...label};
                
                if (visibility === 'all') {
                    newLabel.text = `${label.zone}${label.letter}`;
                    newLabel.size = 1.2;
                } else if (visibility === 'zones') {
                    newLabel.text = `${label.zone}`;
                    newLabel.size = 1.5;
                } else if (visibility === 'letters') {
                    newLabel.text = `${label.letter}`;
                    newLabel.size = 1.2;
                } else {
                    newLabel.text = '';
                    newLabel.size = 0;
                }
                
                return newLabel;
            });
            
            globe.labelsData(updatedLabels);
        });
        
        document.getElementById('reset-view').addEventListener('click', function() {
            globe.pointOfView({ lat: 0, lng: 0, altitude: 2.5 }, 1000);
            document.getElementById('selected-zone').textContent = 'روی یک زون کلیک کنید';
        });
        
        // تنظیم نمای اولیه
        globe.pointOfView({ lat: 20, lng: 50, altitude: 2 });
        
        // اطلاعات اولیه
        document.getElementById('selected-zone').innerHTML = 
            'روی هر یک از <span class="highlight">۱۲۰۰ زون UTM</span> کلیک کنید<br>' 
           
            
        
        // بارگذاری گریدها با تاخیر
        setTimeout(() => {
            updateGrids();
        }, 500);
    </script>
</body>
</html>