<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <title>Ú©Ø±Ù‡ Ø²Ù…ÛŒÙ† Ø¨Ø§ Û±Û²Û°Û° Ø²ÙˆÙ† UTM - Ù†Ø³Ø®Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Vazirmatn", Tahoma, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c2e 0%, #1a1a3e 100%);
            color: #fff;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        #globe-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        /* Mobile-first Ø·Ø±Ø§Ø­ÛŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .header {
            position: absolute;
            top: 10px;
            right: 10px;
            left: 10px;
            text-align: center;
            z-index: 10;
            background: rgba(0, 10, 30, 0.85);
            padding: 12px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(64, 156, 255, 0.4);
            max-width: 95%;
            margin: 0 auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        h1 {
            font-size: clamp(16px, 4vw, 24px);
            margin-bottom: 6px;
            color: #4fc3f7;
            font-weight: 700;
            line-height: 1.3;
        }
        
        .subtitle {
            font-size: clamp(12px, 3vw, 16px);
            opacity: 0.9;
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        /* Controls for mobile first */
        .controls {
            position: absolute;
            bottom: 15px;
            left: 10px;
            right: 10px;
            z-index: 10;
            background: rgba(0, 10, 30, 0.85);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(64, 156, 255, 0.4);
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 100%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-size: clamp(13px, 3.2vw, 15px);
            color: #bbdefb;
            font-weight: 500;
        }
        
        button, select {
            padding: clamp(10px, 3vw, 14px) clamp(12px, 3vw, 16px);
            background: linear-gradient(135deg, rgba(32, 64, 128, 0.9) 0%, rgba(16, 32, 64, 0.9) 100%);
            color: white;
            border: 2px solid rgba(64, 156, 255, 0.6);
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(13px, 3.2vw, 15px);
            transition: all 0.3s ease;
            font-weight: 500;
            min-height: 44px; /* Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø±Ø§ÛŒ Ù„Ù…Ø³ */
        }
        
        button:active, select:active {
            transform: scale(0.98);
        }
        
        button:hover, select:hover {
            background: rgba(64, 128, 255, 0.9);
            border-color: #4fc3f7;
        }
        
        .info-panel {
            position: absolute;
            top: 250px;
            right: 10px;
            z-index: 10;
            background: rgba(0, 10, 30, 0.9);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(64, 156, 255, 0.4);
            max-width: 92%;
            font-size: clamp(12px, 3vw, 14px);
            line-height: 1.5;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            height: 200px;
        }
        
        .info-title {
            color: #4fc3f7;
            margin-bottom: 8px;
            font-size: clamp(14px, 3.5vw, 18px);
            font-weight: 600;
        }
        
        .zone-info {
            color: #e3f2fd;
            line-height: 1.6;
        }
        
        .highlight {
            color: #ffcc80;
            font-weight: bold;
        }
        
        .grid-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .grid-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .grid-buttons button {
            flex: 1;
            min-width: 45%;
            font-size: clamp(12px, 3vw, 14px);
        }
        
        .grid-status {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .grid-indicator {
            font-size: clamp(11px, 2.8vw, 13px);
            padding: 6px 10px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            flex: 1;
            text-align: center;
            min-width: 120px;
        }
        
        .utm-grid { 
            color: #69f0ae; 
            background: rgba(105, 240, 174, 0.1) !important;
        }
        
        .geo-grid { 
            color: #ff5252; 
            background: rgba(255, 82, 82, 0.1) !important;
        }
        
        .active {
            background: linear-gradient(135deg, rgba(64, 128, 255, 0.95) 0%, rgba(32, 64, 255, 0.95) 100%) !important;
            border-color: #4fc3f7 !important;
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.3);
        }
        
        /* Loading indicator */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(12, 12, 46, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            gap: 20px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(79, 195, 247, 0.3);
            border-top-color: #4fc3f7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Performance mode indicator */
        .performance-mode {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(255, 193, 7, 0.9);
            color: #000;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
            display: none;
        }
        
        /* Tablet Styles (768px and up) */
        @media (min-width: 768px) {
            .header {
                top: 20px;
                right: 20px;
                left: 20px;
                padding: 15px;
                max-width: 600px;
            }
            
            .controls {
                bottom: 30px;
                left: 20px;
                right: auto;
                max-width: 320px;
            }
            
            .info-panel {
                top: auto;
                bottom: 30px;
                right: 20px;
                max-width: 350px;
                top: 150px;
            }
            
            .grid-buttons {
                flex-wrap: nowrap;
            }
            
            .grid-buttons button {
                min-width: auto;
            }
        }
        
        /* Desktop Styles (1024px and up) */
        @media (min-width: 1024px) {
            .controls {
                max-width: 350px;
            }
            
            .info-panel {
                max-width: 380px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .subtitle {
                font-size: 18px;
            }
        }
        
        /* Small mobile devices (under 360px) */
        @media (max-width: 400px) {
            .controls {
                padding: 12px;
                gap: 10px;
            }
            
            .grid-buttons {
                flex-direction: column;
            }
            
            .grid-buttons button {
                min-width: 100%;
            }
            
            .grid-status {
                flex-direction: column;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0a0a1a 0%, #151530 100%);
            }
            
            .header, .controls, .info-panel {
                background: rgba(5, 5, 15, 0.92);
            }
        }
        
        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .spinner {
                animation: none;
            }
        }
        
        /* High contrast mode */
        @media (prefers-contrast: high) {
            .header, .controls, .info-panel {
                background: #000;
                border: 2px solid #fff;
            }
            
            button, select {
                border: 2px solid #fff;
            }
        }
    </style>
</head>
<body>
    <div class="performance-mode" id="performance-mode">
        ğŸ”‹ Ø­Ø§Ù„Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ
    </div>
    
    <div id="globe-container"></div>
    
    <div class="header">
        <h1>ğŸŒ Ú©Ø±Ù‡ Ø²Ù…ÛŒÙ† Ø¨Ø§ Û±Û²Û°Û° Ø²ÙˆÙ† UTM</h1>
        <div class="subtitle">  Ø§Ú¯Ø± Ø¨Ø§ Ù…ÙˆØ¨Ø§ÛŒÙ„ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§ÛŒØ¯ Ø­Ø§Ù„Øª Ø¯Ø³Ú©ØªØ§Ù¾ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯</div>
        <div class="subtitle" id="device-info"></div>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label for="rotation-speed">Ø³Ø±Ø¹Øª Ú†Ø±Ø®Ø´:</label>
            <select id="rotation-speed">
                <option value="0">Ø¨Ø¯ÙˆÙ† Ú†Ø±Ø®Ø´</option>
                <option value="0.3" selected>Ú©Ù†Ø¯</option>
                <option value="0.6">Ù…ØªÙˆØ³Ø·</option>
                <option value="1">Ø³Ø±ÛŒØ¹</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="label-visibility">Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§:</label>
            <select id="label-visibility">
                <option value="optimized" selected>Ù‡ÙˆØ´Ù…Ù†Ø¯ (ØªØ·Ø¨ÛŒÙ‚ÛŒ)</option>
                <option value="all">Ù‡Ù…Ù‡ (Grid Zone Designation)</option>
                <option value="zones">Zone Number</option>
                <option value="letters">Zone Letter Only</option>
                <option value="none">None</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>Ú©Ù†ØªØ±Ù„ Ú¯Ø±ÛŒØ¯:</label>
            <div class="grid-controls">
                <div class="grid-buttons">
                    <button id="toggle-utm-grid" class="active">UTM Grid</button>
                    <button id="toggle-geo-grid">Geographic Grid</button>
                </div>
                <div class="grid-buttons">
                    <button id="toggle-both-grids">Ù‡Ø± Ø¯Ùˆ Ú¯Ø±ÛŒØ¯</button>
                    <button id="clear-grids">Ø¨Ø¯ÙˆÙ† Ú¯Ø±ÛŒØ¯</button>
                </div>
                <div class="grid-status">
                    <span class="grid-indicator utm-grid" id="utm-status">UTM: Ø±ÙˆØ´Ù†</span>
                    <span class="grid-indicator geo-grid" id="geo-status">Geo: Ø®Ø§Ù…ÙˆØ´</span>
                </div>
            </div>
        </div>
        
        <button id="performance-toggle">ğŸ”‹ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯</button>
        <button id="reset-view">â†º Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒ Ú©Ø±Ù‡</button>
    </div>
    
    <div class="info-panel">
        <div class="info-title">ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÙˆÙ† UTM</div>
        <div class="zone-info">
            <span id="selected-zone">Ø±ÙˆÛŒ ÛŒÚ© Ø²ÙˆÙ† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</span>
        </div>
    </div>

    <script>
        // ğŸ”§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ùˆ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§
        const deviceInfo = {
            isMobile: /iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isTablet: /iPad|Android(?!.*Mobile)|Tablet/i.test(navigator.userAgent),
            isDesktop: !/iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isTouch: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
            screenWidth: window.innerWidth,
            screenHeight: window.innerHeight,
            pixelRatio: window.devicePixelRatio || 1,
            memory: navigator.deviceMemory || 4, // Ø­Ø§ÙØ¸Ù‡ RAM Ø¯Ø± Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª
            connection: navigator.connection ? {
                effectiveType: navigator.connection.effectiveType,
                saveData: navigator.connection.saveData
            } : null
        };
        
        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡
        document.getElementById('device-info').textContent = 
            `Ø¯Ø³ØªÚ¯Ø§Ù‡: ${deviceInfo.isMobile ? 'Ù…ÙˆØ¨Ø§ÛŒÙ„' : deviceInfo.isTablet ? 'ØªØ¨Ù„Øª' : 'Ø¯Ø³Ú©ØªØ§Ù¾'} | Ø±Ø²ÙˆÙ„ÙˆØ´Ù†: ${deviceInfo.screenWidth}Ã—${deviceInfo.screenHeight}`;
        
        // Ø­Ø§Ù„Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        let performanceMode = deviceInfo.isMobile || deviceInfo.screenWidth < 768 || deviceInfo.memory < 4;
        const performanceModeElement = document.getElementById('performance-mode');
        
        if (performanceMode) {
            performanceModeElement.style.display = 'block';
            performanceModeElement.textContent = `ğŸ”‹ Ø­Ø§Ù„Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ (RAM: ${deviceInfo.memory}GB)`;
        }
        
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡
        const letters = 'CDEFGHJKLMNPQRSTUVWX';
        let labels = [];
        
        // ğŸ”§ ØªØ§Ø¨Ø¹ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡
        function createSmartLabels() {
            const labelsArray = [];
            
            // Ø¯Ø± Ø­Ø§Ù„Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒØŒ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ú©Ù…ØªØ±ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            const lonStep = performanceMode ? 12 : 6; // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„: Ù‡Ø± 12 Ø¯Ø±Ø¬Ù‡
            const latStep = performanceMode ? 16 : 8;  // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„: Ù‡Ø± 16 Ø¯Ø±Ø¬Ù‡
            
            let zoneCount = 0;
            
            for (let zone = 1; zone <= 60; zone += (performanceMode ? 2 : 1)) {
                for (let bandIdx = 0; bandIdx < 20; bandIdx += (performanceMode ? 2 : 1)) {
                    const letter = letters[bandIdx];
                    const lonCenter = (zone - 30.5) * 6;
                    const latCenter = bandIdx * 8 + 4 - 80;
                    
                    labelsArray.push({
                        id: `${zone}${letter}`,
                        lat: latCenter,
                        lng: lonCenter,
                        text: performanceMode ? `${zone}` : `${zone}${letter}`,
                        size: deviceInfo.isMobile ? 0.8 : 1.2,
                        color: '#ffffff',
                        zone: zone,
                        letter: letter,
                        latCenter: latCenter,
                        lngCenter: lonCenter,
                        latRange: `${latCenter-4}Â° ØªØ§ ${latCenter+4}Â°`,
                        lngRange: `${lonCenter-3}Â° ØªØ§ ${lonCenter+3}Â°`,
                        priority: zoneCount % 3 === 0 ? 'high' : 'normal'
                    });
                    
                    zoneCount++;
                }
            }
            
            console.log(`Ø§ÛŒØ¬Ø§Ø¯ ${zoneCount} Ø¨Ø±Ú†Ø³Ø¨ (Ø­Ø§Ù„Øª ${performanceMode ? 'Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ' : 'Ø¹Ø§Ø¯ÛŒ'})`);
            return labelsArray;
        }
        
        // ğŸ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ù‡ Ø²Ù…ÛŒÙ† Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯
        const globe = Globe()
            .globeImageUrl(performanceMode 
                ? '//unpkg.com/three-globe/example/img/earth-dark.jpg'  // ØªØµÙˆÛŒØ± Ø³Ø¨Ú©â€ŒØªØ± Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
                : '//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
            .bumpImageUrl(performanceMode ? null : '//unpkg.com/three-globe/example/img/earth-topology.png')  // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ ØºÛŒØ±ÙØ¹Ø§Ù„
            .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
            .showAtmosphere(!performanceMode)  // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ ØºÛŒØ±ÙØ¹Ø§Ù„
            .atmosphereColor('#3a228a')
            .atmosphereAltitude(0.15)
            .labelColor(() => '#ffffff')
            .labelAltitude(0.01)
            .labelResolution(performanceMode ? 2 : 3)
            .labelDotRadius(performanceMode ? 0.2 : 0.3)
            .labelSize(d => d.size * (deviceInfo.isMobile ? 0.7 : 1))
            (document.getElementById('globe-container'));
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
        labels = createSmartLabels();
        globe.labelsData(labels)
            .labelLat(d => d.lat)
            .labelLng(d => d.lng)
            .labelText(d => d.text)
            .labelSize(d => d.size * (deviceInfo.isMobile ? 0.8 : 1))
            .onLabelClick(label => {
                document.getElementById('selected-zone').innerHTML = 
                    `<span class="highlight">Ø²ÙˆÙ† ${label.id}</span><br>
                     Ù…Ø®ØªØµØ§Øª Ù…Ø±Ú©Ø²: ${label.lat.toFixed(2)}Â°N, ${label.lng.toFixed(2)}Â°E<br>
                     Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø¹Ø±Ø¶ÛŒ: ${label.latRange}<br>
                     Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø·ÙˆÙ„ÛŒ: ${label.lngRange}<br>
                     <span style="color: #69f0ae; font-size: ${deviceInfo.isMobile ? '12px' : '14px'};">Ø³ÛŒØ³ØªÙ… UTM: 6Â° Ã— 8Â°</span>`;
            });
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ú¯Ø±ÛŒØ¯
        let utmGridEnabled = !deviceInfo.isMobile; // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§ÙˆÙ„ÛŒÙ‡ Ø®Ø§Ù…ÙˆØ´
        let geoGridEnabled = false;
        
        // ğŸ”§ ØªØ§Ø¨Ø¹ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÛŒØ¯
        function createSmartGrid(type) {
            const gridLines = [];
            const color = type === 'utm' ? '#69f0ae' : '#ff5252';
            
            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÚ¯Ø§Ù‡
            const lonStep = performanceMode ? 
                (type === 'utm' ? 12 : 30) :  // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„: UTM Ù‡Ø± 12 Ø¯Ø±Ø¬Ù‡ØŒ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ Ù‡Ø± 30 Ø¯Ø±Ø¬Ù‡
                (type === 'utm' ? 6 : 15);    // Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾: UTM Ù‡Ø± 6 Ø¯Ø±Ø¬Ù‡ØŒ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ Ù‡Ø± 15 Ø¯Ø±Ø¬Ù‡
            
            const latStep = performanceMode ? 
                (type === 'utm' ? 16 : 30) :  // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
                (type === 'utm' ? 8 : 15);    // Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾
            
            const pointDensity = performanceMode ? 4 : 2; // ØªØ±Ø§Ú©Ù… Ù†Ù‚Ø§Ø·
            
            if (type === 'utm') {
                // Ø®Ø·ÙˆØ· Ø·ÙˆÙ„ÛŒ UTM
                for (let lon = -180; lon <= 180; lon += lonStep) {
                    const line = [];
                    for (let lat = -80; lat <= 84; lat += pointDensity) {
                        line.push([lat, lon]);
                    }
                    if (line.length > 0) {
                        gridLines.push({
                            coords: line,
                            color: color,
                            type: 'utm_meridian'
                        });
                    }
                }
                
                // Ø®Ø·ÙˆØ· Ø¹Ø±Ø¶ÛŒ UTM
                for (let lat = -80; lat <= 84; lat += latStep) {
                    const line = [];
                    for (let lon = -180; lon <= 180; lon += pointDensity) {
                        line.push([lat, lon]);
                    }
                    if (line.length > 0) {
                        gridLines.push({
                            coords: line,
                            color: color,
                            type: 'utm_parallel'
                        });
                    }
                }
            } else {
                // Ø®Ø·ÙˆØ· Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ
                for (let lon = -180; lon <= 180; lon += lonStep) {
                    const line = [];
                    for (let lat = -90; lat <= 90; lat += pointDensity) {
                        line.push([lat, lon]);
                    }
                    gridLines.push({
                        coords: line,
                        color: color,
                        type: 'geo_meridian'
                    });
                }
                
                // Ø®Ø·ÙˆØ· Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ
                for (let lat = -90; lat <= 90; lat += latStep) {
                    const line = [];
                    for (let lon = -180; lon <= 180; lon += pointDensity) {
                        line.push([lat, lon]);
                    }
                    gridLines.push({
                        coords: line,
                        color: color,
                        type: 'geo_parallel'
                    });
                }
            }
            
            return gridLines;
        }
        
        // ğŸ”§ ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø±ÛŒØ¯Ù‡Ø§
        function updateGrids() {
            let allPaths = [];
            
            if (utmGridEnabled) {
                allPaths = allPaths.concat(createSmartGrid('utm'));
            }
            
            if (geoGridEnabled) {
                allPaths = allPaths.concat(createSmartGrid('geo'));
            }
            
            // Ø§Ø¹Ù…Ø§Ù„ Ú¯Ø±ÛŒØ¯ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯
            globe.pathsData(allPaths)
                .pathPoints(d => d.coords)
                .pathColor(d => d.color)
                .pathStroke(performanceMode ? 0.5 : 0.7)
                .pathDashLength(0)
                .pathDashGap(0)
                .pathDashAnimateTime(0);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
            document.getElementById('utm-status').textContent = `UTM: ${utmGridEnabled ? 'Ø±ÙˆØ´Ù†' : 'Ø®Ø§Ù…ÙˆØ´'}`;
            document.getElementById('geo-status').textContent = `Geo: ${geoGridEnabled ? 'Ø±ÙˆØ´Ù†' : 'Ø®Ø§Ù…ÙˆØ´'}`;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¸Ø§Ù‡Ø± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.getElementById('toggle-utm-grid').className = utmGridEnabled ? 'active' : '';
            document.getElementById('toggle-geo-grid').className = geoGridEnabled ? 'active' : '';
        }
        
        // ğŸ”§ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ
        document.getElementById('toggle-utm-grid').addEventListener('click', function() {
            utmGridEnabled = !utmGridEnabled;
            updateGrids();
        });
        
        document.getElementById('toggle-geo-grid').addEventListener('click', function() {
            geoGridEnabled = !geoGridEnabled;
            updateGrids();
        });
        
        document.getElementById('toggle-both-grids').addEventListener('click', function() {
            utmGridEnabled = true;
            geoGridEnabled = true;
            updateGrids();
        });
        
        document.getElementById('clear-grids').addEventListener('click', function() {
            utmGridEnabled = false;
            geoGridEnabled = false;
            updateGrids();
        });
        
        // ğŸ”§ Ú©Ù†ØªØ±Ù„ Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ
        document.getElementById('performance-toggle').addEventListener('click', function() {
            performanceMode = !performanceMode;
            performanceModeElement.style.display = performanceMode ? 'block' : 'none';
            
            // Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ Ø¨Ø§ Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯
            labels = createSmartLabels();
            globe.labelsData(labels);
            
            // Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ú¯Ø±ÛŒØ¯Ù‡Ø§
            updateGrids();
            
            // ØªØºÛŒÛŒØ± Ù…ØªÙ† Ø¯Ú©Ù…Ù‡
            this.textContent = performanceMode ? 'ğŸš€ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ' : 'ğŸ”‹ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯';
            performanceModeElement.textContent = performanceMode ? 
                `ğŸ”‹ Ø­Ø§Ù„Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ ÙØ¹Ø§Ù„ (${deviceInfo.memory}GB RAM)` : '';
        });
        
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ú©Ø±Ù‡
        globe.controls().autoRotate = !deviceInfo.isMobile; // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§ÙˆÙ„ÛŒÙ‡ ØºÛŒØ±ÙØ¹Ø§Ù„
        globe.controls().autoRotateSpeed = 0.6;
        globe.controls().enableZoom = true;
        globe.controls().enablePan = deviceInfo.isDesktop; // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù¾Ù† ØºÛŒØ±ÙØ¹Ø§Ù„
        globe.controls().dampingFactor = 0.1;
        
        // ğŸ”§ Ú©Ù†ØªØ±Ù„ Ú†Ø±Ø®Ø´
        document.getElementById('rotation-speed').addEventListener('change', function(e) {
            const speed = parseFloat(e.target.value);
            globe.controls().autoRotate = speed > 0;
            globe.controls().autoRotateSpeed = speed;
        });
        
        // ğŸ”§ Ú©Ù†ØªØ±Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
        document.getElementById('label-visibility').addEventListener('change', function(e) {
            const visibility = e.target.value;
            
            if (visibility === 'optimized') {
                // Ø­Ø§Ù„Øª Ù‡ÙˆØ´Ù…Ù†Ø¯: ØªØ·Ø¨ÛŒÙ‚ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ø¯Ø³ØªÚ¯Ø§Ù‡
                const updatedLabels = labels.map(label => ({
                    ...label,
                    text: performanceMode ? `${label.zone}` : `${label.zone}${label.letter}`,
                    size: deviceInfo.isMobile ? 0.8 : 1.2
                }));
                globe.labelsData(updatedLabels);
            } else {
                const updatedLabels = labels.map(label => {
                    const newLabel = {...label};
                    
                    if (visibility === 'all') {
                        newLabel.text = `${label.zone}${label.letter}`;
                        newLabel.size = deviceInfo.isMobile ? 0.9 : 1.2;
                    } else if (visibility === 'zones') {
                        newLabel.text = `${label.zone}`;
                        newLabel.size = deviceInfo.isMobile ? 1.0 : 1.5;
                    } else if (visibility === 'letters') {
                        newLabel.text = `${label.letter}`;
                        newLabel.size = deviceInfo.isMobile ? 0.9 : 1.2;
                    } else {
                        newLabel.text = '';
                        newLabel.size = 0;
                    }
                    
                    return newLabel;
                });
                
                globe.labelsData(updatedLabels);
            }
        });
        
        // ğŸ”§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒ Ú©Ø±Ù‡
        document.getElementById('reset-view').addEventListener('click', function() {
            const initialView = deviceInfo.isMobile ? 
                { lat: 30, lng: 50, altitude: 2.2 } :  // Ø²ÙˆÙ… Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
                { lat: 20, lng: 50, altitude: 2.0 };
            
            globe.pointOfView(initialView, 1000);
            document.getElementById('selected-zone').textContent = 'Ø±ÙˆÛŒ ÛŒÚ© Ø²ÙˆÙ† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯';
        });
        
        // ğŸ”§ ØªÙ†Ø¸ÛŒÙ… Ù†Ù…Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡
        const initialView = deviceInfo.isMobile ? 
            { lat: 30, lng: 50, altitude: 2.2 } : 
            { lat: 20, lng: 50, altitude: 2.0 };
        
        globe.pointOfView(initialView);
        
        // ğŸ”§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ø±ÛŒØ¯Ù‡Ø§ Ø¨Ø§ ØªØ§Ø®ÛŒØ± Ù‡ÙˆØ´Ù…Ù†Ø¯
        setTimeout(() => {
            updateGrids();
        }, deviceInfo.isMobile ? 1000 : 500);
        
        // ğŸ”§ ØªØ·Ø¨ÛŒÙ‚ Ø¨Ø§ ØªØºÛŒÛŒØ± Ø³Ø§ÛŒØ² Ù¾Ù†Ø¬Ø±Ù‡
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                const newWidth = window.innerWidth;
                const newHeight = window.innerHeight;
                
                // Ø§Ú¯Ø± Ø¯Ø³ØªÚ¯Ø§Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ (Ù…Ø«Ù„Ø§ Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡)
                if (newWidth < 768 && !performanceMode) {
                    performanceMode = true;
                    performanceModeElement.style.display = 'block';
                    
                    // Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯
                    labels = createSmartLabels();
                    globe.labelsData(labels);
                    updateGrids();
                }
            }, 250);
        });
        
        // ğŸ”§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
        document.getElementById('selected-zone').innerHTML = 
            `Ø±ÙˆÛŒ Ù‡Ø± ÛŒÚ© Ø§Ø² <span class="highlight"> Ø²ÙˆÙ† Ù‡Ø§ÛŒ UTM</span> Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯<br>
             <small>Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ: ${performanceMode ? 'Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ' : 'Ø¹Ø§Ø¯ÛŒ'} | Ø¯Ø³ØªÚ¯Ø§Ù‡: ${deviceInfo.isMobile ? 'Ù…ÙˆØ¨Ø§ÛŒÙ„' : deviceInfo.isTablet ? 'ØªØ¨Ù„Øª' : 'Ø¯Ø³Ú©ØªØ§Ù¾'}</small>`;
        
        // ğŸ”§ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
        if (deviceInfo.isTouch) {
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('#globe-container')) {
                    e.preventDefault();
                }
            }, { passive: false });
        }
        
        // ğŸ”§ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù†
        console.log(`âœ… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª! ØªÙ†Ø¸ÛŒÙ…Ø§Øª: 
        - Ø¯Ø³ØªÚ¯Ø§Ù‡: ${deviceInfo.isMobile ? 'Ù…ÙˆØ¨Ø§ÛŒÙ„' : deviceInfo.isTablet ? 'ØªØ¨Ù„Øª' : 'Ø¯Ø³Ú©ØªØ§Ù¾'}
        - RAM: ${deviceInfo.memory}GB
        - Ø­Ø§Ù„Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ: ${performanceMode ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
        - Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§: ${labels.length}
        - Ø±Ø²ÙˆÙ„ÙˆØ´Ù†: ${deviceInfo.screenWidth}Ã—${deviceInfo.screenHeight}`);
    </script>
</body>
</html>